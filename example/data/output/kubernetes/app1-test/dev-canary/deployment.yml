apiVersion: apps/v1
kind: Deployment

metadata:
  name: app1-test-dev-canary
  labels:
    app: app1-test-dev-canary

spec:
  replicas: 1
  selector:
    matchLabels:
      app: app1-test-dev-canary
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  minReadySeconds: 5
  progressDeadlineSeconds: 120

  template:
    metadata:
      labels:
        app: app1-test-dev-canary
    spec:
      hostAliases:
        - {"ip":"127.0.0.1","hostnames":[null]}

      volumes:
        - name: august-runtime-creds-volume
          persistentVolumeClaim:
            claimName: august-runtime-creds-pvc
        - name: node
          hostPath:
            path: /logs

      dnsPolicy: ClusterFirst

      containers:
        - name: -nginx-dev-canary
          image: 012345677.dkr.ecr.us-east-1.amazonaws.com/-nginx:latest
          imagePullPolicy: Always

          ports:
            - containerPort: 3030

          

          resources:
            requests: {"cpu":"25m","memory":"100Mi"}
            limits: {"memory":"200Mi"}

          volumeMounts:
            - name: node
              mountPath: /logs
            - name: mount.name
              mountPath: mount.mountPath
            - name: mount.name
              mountPath: mount.mountPath
            
            
          readinessProbe: {"httpGet":{"path":"/ping","scheme":"HTTPS","port":443},"initialDelaySeconds":10,"periodSeconds":10,"timeoutSeconds":1,"successThreshold":1,"failureThreshold":3}
          livenessProbe: {"httpGet":{"path":"/ping","scheme":"HTTPS","port":443},"initialDelaySeconds":10,"periodSeconds":3,"timeoutSeconds":1,"successThreshold":1,"failureThreshold":3}
        - name: -dev-canary
          image: 012345677.dkr.ecr.us-east-1.amazonaws.com/:latest
          imagePullPolicy: Always

          ports:
            - containerPort: 10000

          env: [{"name":"NODE_ENV","value":null},{"name":"CLUSTER_MODE_DISABLED","value":"1"}]

          resources:
            requests: {"cpu":"25m","memory":"100Mi"}
            limits: {"memory":"200Mi"}

          volumeMounts:
            - name: node
              mountPath: /logs
            - name: mount.name
              mountPath: mount.mountPath
            - name: mount.name
              mountPath: mount.mountPath
            
            
          readinessProbe: {"httpGet":{"path":"/health","scheme":"HTTP","port":null},"initialDelaySeconds":10,"periodSeconds":10,"timeoutSeconds":1,"successThreshold":1,"failureThreshold":3}
          livenessProbe: {"httpGet":{"path":"/health","scheme":"HTTP","port":null},"initialDelaySeconds":10,"periodSeconds":3,"timeoutSeconds":1,"successThreshold":1,"failureThreshold":3}
        - name: -dev-canary
          image: 012345677.dkr.ecr.us-east-1.amazonaws.com/:latest
          imagePullPolicy: Always

          ports:
            - containerPort: 443

          

          resources:
            
            

          volumeMounts:
            - name: node
              mountPath: /logs
            